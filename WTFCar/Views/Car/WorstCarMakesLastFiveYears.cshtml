
@{
    int thePage = Convert.ToInt32(ViewBag.Page);

    if (thePage > 1)
    {
        thePage = ((thePage * 10) - 9);
    }
    int endThePage = thePage + 9;

    bool isMobile=false;
    string u = Request.ServerVariables["HTTP_USER_AGENT"];
    System.Text.RegularExpressions.Regex b = new System.Text.RegularExpressions.Regex(@"(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino", System.Text.RegularExpressions.RegexOptions.IgnoreCase | System.Text.RegularExpressions.RegexOptions.Multiline);
    System.Text.RegularExpressions.Regex v = new System.Text.RegularExpressions.Regex(@"1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-", System.Text.RegularExpressions.RegexOptions.IgnoreCase | System.Text.RegularExpressions.RegexOptions.Multiline);
    if ((b.IsMatch(u) || v.IsMatch(u.Substring(0, 4)))) {
        isMobile = true;
    }


    //setup the CSS for the active page
    string page1Active = "";
    string page2Active = "";
    string page3Active = "";
    string page4Active = "";
    string page5Active = "";
    string page6Active = "";
    string page7Active = "";
    string page8Active = "";
    string page9Active = "";
    string page10Active = "";



    if (ViewBag.Page == 1)
    {
        page1Active = " active";
    }
    else if (ViewBag.Page == 2)
    {
        page2Active = " active";
    }
    else if (ViewBag.Page == 3)
    {
        page3Active = " active";
    }
    else if (ViewBag.Page == 4)
    {
        page4Active = " active";
    }
    else if (ViewBag.Page == 5)
    {
        page5Active = " active";
    }
    else if (ViewBag.Page == 6)
    {
        page6Active = " active";
    }
    else if (ViewBag.Page == 7)
    {
        page7Active = " active";
    }
    else if (ViewBag.Page == 8)
    {
        page8Active = " active";
    }
    else if (ViewBag.Page == 9)
    {
        page9Active = " active";
    }
    else if (ViewBag.Page == 10)
    {
        page10Active = " active";
    }

}


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<div class="jumbotron">
    <h1>Worst Cars By Make - Last 5 Years</h1>
	<h3>Highest Average WTF Car Points (by Car Brand/Make) Over the Last 5 Years</h3>
</div>
<div class="row">
    <div class="col-md-12">

        <div style="text-align:center; width:100%">
            <h2>Worst Cars by Brand / Make </h2>
            <h3>#@thePage - @endThePage</h3>
            <br /><br />
        </div>

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
        <script type="text/javascript" src="/Scripts/chartjs-plugin-style.min.js"></script>

		<div class="chartContainer">
			<canvas id="myChart" style="width:110%"></canvas>
        </div>
		<br /><br />

        <script>
            var ctx = document.getElementById("myChart").getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    @{
                        var comma = ',';
                        var count = 0;
                        var space = ' ';

                    }
                    labels: [
                        @foreach (var wtfc in ViewBag.WorstCars)
                        {
                            if (count > 0)
                            {
                                 @Html.Raw(',')@Html.Raw('"')@wtfc.year@Html.Raw(' ')@wtfc.make@Html.Raw(' ')@wtfc.model@Html.Raw(' ')@Html.Raw('"')
                            }
                            else
                            {
                                @Html.Raw('"')@wtfc.year@Html.Raw(' ')@wtfc.make@Html.Raw(' ')@wtfc.model@Html.Raw(' ')@Html.Raw('"')
                            }

                            count = count + 1;
                        }
                    ],
                    datasets: [

                        {
                            label: 'Average Brand/Make WTF Points',
                            data: [

                                @foreach (var wtfc in ViewBag.WorstCars)
                                {
                                  @wtfc.Totalpts@comma
                                }
                            ],

                            backgroundColor: [

                                'rgba(230, 25, 75, 0.8)',
                                'rgba(60, 180, 75, 0.8)',
                                'rgba(255, 225, 25, 0.8)',
                                'rgba(0, 130, 200, 0.8)',
                                'rgba(245, 130, 48, 0.8)',
                                'rgba(145, 30, 180, 0.8)',
                                'rgba(70, 240, 240, 0.8)',
                                'rgba(240, 50, 230, 0.8)',
                                'rgba(210, 245, 60, 0.8)',
                                'rgba(250, 190, 190, 0.8)',
                                'rgba(0, 128, 128, 0.8)',
                                'rgba(230, 190, 255, 0.8)',
                                'rgba(170, 110, 40, 0.8)',
                                'rgba(255, 250, 200, 0.8)',
                                'rgba(128, 0, 0, 0.8)',
                                'rgba(170, 255, 195, 0.8)',
                                'rgba(128, 128, 0, 0.8)',
                                'rgba(255, 215, 180, 0.8)',
                                'rgba(0, 0, 0, 0.1)',
                                'rgba(230, 25, 75, 0.8)',
                                'rgba(60, 180, 75, 0.8)',
                                'rgba(255, 225, 25, 0.8)',
                                'rgba(0, 130, 200, 0.8)',
                                'rgba(245, 130, 48, 0.8)',
                                'rgba(145, 30, 180, 0.8)',


                            ],
                            borderColor: [
                                'rgba(230, 25, 75, 0.9)',
                                'rgba(60, 180, 75, 0.9)',
                                'rgba(255, 225, 25, 0.9)',
                                'rgba(0, 130, 200, 0.9)',
                                'rgba(245, 130, 48, 0.9)',
                                'rgba(145, 30, 180, 0.9)',
                                'rgba(70, 240, 240, 0.9)',
                                'rgba(240, 50, 230, 0.9)',
                                'rgba(210, 245, 60, 0.9)',
                                'rgba(250, 190, 190, 0.9)',
                                'rgba(0, 128, 128, 0.9)',
                                'rgba(230, 190, 255, 0.9)',
                                'rgba(170, 110, 40, 0.9)',
                                'rgba(255, 250, 200, 0.9)',
                                'rgba(128, 0, 0, 0.9)',
                                'rgba(170, 255, 195, 0.9)',
                                'rgba(128, 128, 0, 0.9)',
                                'rgba(255, 215, 180, 0.9)',
                                'rgba(0, 0, 0, 0.1)',
                                'rgba(230, 25, 75, 0.9)',
                                'rgba(60, 180, 75, 0.9)',
                                'rgba(255, 225, 25, 0.9)',
                                'rgba(0, 130, 200, 0.9)',
                                'rgba(245, 130, 48, 0.9)',
                                'rgba(145, 30, 180, 0.9)',

                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
					responsive: true,
					@{
					if(isMobile==true){
						@Html.Raw("aspectRatio: .95,");
					}
					else{
						@Html.Raw("");
					}
				
				}
                    scales: {
                        xAxes: [{
                            ticks: {
                                beginAtZero: true
                            },
                            stacked: false
                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            },
                            stacked: false
                        }]
                    },
                    bevelWidth: 3,
                    bevelHighlightColor: 'rgba(255, 255, 255, 0.75)',
                    bevelShadowColor: 'rgba(0, 0, 0, 0.7)'
                }
            });




                  var myChartE = document.getElementById("myChart");
				  //myChartE.addEventListener("resize", resized());
                  myChartE.onclick = (function (evt) {
                      var activePoints = myChart.getElementsAtEvent(evt);
                      if (activePoints[0]) {
                          var chartData = activePoints[0]['_chart'].config.data;
                          var idx = activePoints[0]['_index'];

                          var label = chartData.labels[idx];
                          var value = chartData.datasets[0].data[idx];




                          var labelarray = label.split(' ');
						  var newUrl = "";
						  for(var x=0;x<labelarray.length;x++){
							if(x>0){
								if(newUrl.indexOf("Lookup")>0){
									newUrl = newUrl + "/" + labelarray[x];
								}
								else{
									newUrl = newUrl + "/" + labelarray[x];
								}

							}
							else{
								newUrl = "/" + "Car/WorstCarsByMake" + labelarray[x];
							}
						  }
						  document.location.href=newUrl + "1";
						  //document.location.href = "Lookup";
                      };

				  });



            //function resized(){
			//	alert("resized");
			//}




        </script>



    </div>

    <nav aria-label="labelaria" style="text-align:center">
        <ul class="pagination pagination-lg">
        <li class='page-item @page1Active'><a href='/Car/WorstCarMakesLastFiveYears/1' >1</a></li>
            <li class='page-item @page2Active'><a href='/Car/WorstCarMakesLastFiveYears/2' >2</a></li>
            <li class='page-item @page3Active'><a href='/Car/WorstCarMakesLastFiveYears/3' >3</a></li>
            <li class='page-item @page4Active'><a href='/Car/WorstCarMakesLastFiveYears/4' >4</a></li>
            <li class='page-item @page5Active'><a href='/Car/WorstCarMakesLastFiveYears/5' >5</a></li>
            <li class='page-item @page6Active'><a href='/Car/WorstCarMakesLastFiveYears/6' >6</a></li>
            <li class='page-item @page7Active'><a href='/Car/WorstCarMakesLastFiveYears/7' >7</a></li>
            <li class='page-item @page8Active'><a href='/Car/WorstCarMakesLastFiveYears/8' >8</a></li>
            <li class='page-item @page9Active'><a href='/Car/WorstCarMakesLastFiveYears/9' >9</a></li>
            <li class='page-item @page10Active'><a href='/Car/WorstCarMakesLastFiveYears/10' >10</a></li>
        </ul>
    </nav>

</div>
